# CVE-2021-44077.md

### Overview

On September 16, 2021, the company ManageEngine (a subsidiary of Zoho) released version 11306 of ManageEngine ServiceDesk Plus to patch the vulnerability CVE-2021-44077.

CVE-2021-44077 is an authentication bypass vulnerability affecting (on-premises) installations of ManageEngine ServiceDesk Plus using versions 11305 and earlier.

The source of the vulnerability was an improper security configuration process used in ServiceDesk Plus, and it allowed attackers to gain unauthorized access to the application's data through several of its application URLs.

### Detail

![image](https://user-images.githubusercontent.com/63194321/155062895-5a0d68cd-f333-4b16-87f7-ae29932d86aa.png)

According to ManageEngine on the homepage, this is a vulnerability that bypasses authentication to upload arbitrary files.

The original cause given by the developers was that the APIs did not validate the input and allow uploading and executing those files. 

1. The first is the RestAPI that is called when new software needs to be installed `s247AgentInstallationProcess`.

![image](https://user-images.githubusercontent.com/63194321/155074610-0935d57f-bcc3-4cbb-b156-143025aec5cb.png)

> This RestAPI `s247AgentInstallationProcess` then calls an RestAPI `S247Util.installAgentProgress(apikey)` 

![image](https://user-images.githubusercontent.com/63194321/155075301-bbaffab1-6325-4760-9305-4bf227c7fac5.png)

The main essence of this RestAPI is to call the Windows Installer [msiexec.exe](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/msiexec) utility from the command line to install software installed with the `Site24x7WindowsAgent.msi`.

Normally, the `msiexec.exe` utility of ManageEngine ServiceDesk Plus will be located at the path: `ManageEngine\ServicesDesk\bin`. 
And the command line structure to install that is: `C:\Program Files\ManageEngine\ServiceDesk\bin\msiexec.exe /i Site24x7WindowsAgent.msi EDITA1=apikey /qn` 

2. Next we will analyze the file upload without input validation which the main cause here is RestAPI `ImportTechniciansAction`.

![image](https://user-images.githubusercontent.com/63194321/155081111-9914d249-1c13-45e4-968d-c4db220f9076.png)

With the `iuf.getTheFile()` function, RestApi will write files directly to the file without authentication. If the file already exists, the old file() will be overwritten. 

Now if the attacker uploads a file named `msiexec.exe` then the old file in the system will be overwritten. After the attacker calls the API `s247AgentInstallationProcess`, 
the file `msiexec.exe` will be executed from which the attacker can RCE the victim machine. 




